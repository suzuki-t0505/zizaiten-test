/* セッション0.7.2 - 2025-10-15 */
/* SP縦画面専用レイアウト */
/* 修正: サジェスト表示不具合を修正（fixed配置に変更） */

/* ========================================
   SP縦画面時のレイアウト
   ======================================== */
@media (max-width: 768px) and (orientation: portrait) {
    /* ========================================
       タブ切り替え
       ======================================== */
    .tabs-desktop {
        display: none;
    }
    
    .tabs-mobile-container {
        display: flex;
        position: fixed;
        bottom: var(--footer-height);
        left: 0;
        right: 0;
        z-index: var(--z-mobile-tab);
        gap: 10px;
        padding: var(--spacing-sm);
        background: var(--color-bg-primary);
        border-top: 1px solid var(--color-border-normal);
        width: 100%;
        justify-content: center;
        height: var(--tab-height-sp);
    }
    
    .tabs-mobile-container .accordion-tab {
        width: 80px;
        height: 22px;
        writing-mode: horizontal-tb;
        border-radius: var(--radius-lg);
        border: 1px solid var(--color-border-normal);
        margin-bottom: 0;
    }
    
    .tabs-mobile-container .accordion-tab.active {
        background: var(--color-primary);
        color: var(--color-text-white);
    }
    
    /* ========================================
       パネルコンテナを縦方向に
       ======================================== */
    .panels-container {
        flex-direction: column;
        position: relative;
    }
    
    /* ========================================
       JSコンテンツを通常配置、下部にパディング
       ======================================== */
    .js-content {
        flex: 1;
        height: auto;
        padding-bottom: calc(var(--tab-height-sp) + var(--footer-height));
        transition: padding-bottom var(--transition-slow);
    }
    
    .js-content.info-visible:not(.list-visible) {
        padding-bottom: calc(var(--tab-height-sp) + var(--footer-height) + var(--info-height-sp));
    }
    
    .js-content.list-visible:not(.info-visible) {
        padding-bottom: calc(var(--tab-height-sp) + var(--footer-height) + var(--list-height-sp));
    }
    
    .js-content.info-visible.list-visible {
        padding-bottom: calc(var(--tab-height-sp) + var(--footer-height) + var(--info-height-sp) + var(--list-height-sp));
    }
    
    /* ========================================
       ボタン類の位置調整
       ======================================== */
    .content .js-content .control-buttons-left {
        bottom: calc(var(--control-bottom-base) + var(--footer-height));
    }
    .content .js-content .control-buttons-right {
        bottom: calc(var(--control-bottom-base) + var(--footer-height));
    }
    .content .js-content .sequence-bar-container {
        bottom: calc(var(--seekbar-bottom-base) + var(--footer-height));
    }
    .content .js-content .frame-display {
        bottom: calc(var(--frame-bottom-base) + var(--footer-height));
    }
    
    .content .js-content.info-visible:not(.list-visible) .control-buttons-left {
        bottom: calc(var(--control-bottom-base) + var(--footer-height) + var(--info-height-sp));
    }
    .content .js-content.info-visible:not(.list-visible) .control-buttons-right {
        bottom: calc(var(--control-bottom-base) + var(--footer-height) + var(--info-height-sp));
    }
    .content .js-content.info-visible:not(.list-visible) .sequence-bar-container {
        bottom: calc(var(--seekbar-bottom-base) + var(--footer-height) + var(--info-height-sp));
    }
    .content .js-content.info-visible:not(.list-visible) .frame-display {
        bottom: calc(var(--frame-bottom-base) + var(--footer-height) + var(--info-height-sp));
    }
    
    .content .js-content.list-visible:not(.info-visible) .control-buttons-left {
        bottom: calc(var(--control-bottom-base) + var(--footer-height) + var(--list-height-sp));
    }
    .content .js-content.list-visible:not(.info-visible) .control-buttons-right {
        bottom: calc(var(--control-bottom-base) + var(--footer-height) + var(--list-height-sp));
    }
    .content .js-content.list-visible:not(.info-visible) .sequence-bar-container {
        bottom: calc(var(--seekbar-bottom-base) + var(--footer-height) + var(--list-height-sp));
    }
    .content .js-content.list-visible:not(.info-visible) .frame-display {
        bottom: calc(var(--frame-bottom-base) + var(--footer-height) + var(--list-height-sp));
    }
    
    .content .js-content.info-visible.list-visible .control-buttons-left {
        bottom: calc(var(--control-bottom-base) + var(--footer-height) + var(--info-height-sp) + var(--list-height-sp));
    }
    .content .js-content.info-visible.list-visible .control-buttons-right {
        bottom: calc(var(--control-bottom-base) + var(--footer-height) + var(--info-height-sp) + var(--list-height-sp));
    }
    .content .js-content.info-visible.list-visible .sequence-bar-container {
        bottom: calc(var(--seekbar-bottom-base) + var(--footer-height) + var(--info-height-sp) + var(--list-height-sp));
    }
    .content .js-content.info-visible.list-visible .frame-display {
        bottom: calc(var(--frame-bottom-base) + var(--footer-height) + var(--info-height-sp) + var(--list-height-sp));
    }
    
    /* ========================================
       情報パネルラッパーを固定配置
       ======================================== */
    .info-panel-wrapper {
        position: fixed;
        bottom: calc(var(--tab-height-sp) + var(--footer-height));
        left: 0;
        right: 0;
        width: 100%;
        min-width: 0;
        height: var(--info-height-sp);
        z-index: var(--z-info-panel);
        transition: transform var(--transition-slow);
        transform: translateY(var(--info-height-sp));
    }
    
    .info-panel-wrapper.visible {
        width: 100%;
        min-width: 0;
        transform: translateY(0);
    }
    
    .product-info {
        width: 100%;
        border-right: none;
        border-top: 1px solid var(--color-border-normal);
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        transform: translateX(0);
        padding-left: 0;
    }
    
    /* ========================================
       リストパネルラッパーを固定配置
       ======================================== */
    .list-panel-wrapper {
        position: fixed;
        bottom: calc(var(--tab-height-sp) + var(--footer-height));
        left: 0;
        right: 0;
        width: 100%;
        min-width: 0;
        height: var(--list-height-sp);
        z-index: var(--z-list-panel);
        transition: transform var(--transition-slow);
        transform: translateY(var(--list-height-sp));
    }
    
    .list-panel-wrapper.visible {
        width: 100%;
        min-width: 0;
        transform: translateY(0);
    }
    
    .content-list {
        width: 100%;
        border-right: none;
        border-top: 1px solid var(--color-border-normal);
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        transform: translateX(0);
    }
    
    .info-panel-wrapper.visible ~ .list-panel-wrapper.visible:not(.fullscreen) {
        transform: translateY(calc(var(--info-height-sp) * -1));
    }
    
    .list-panel-wrapper.fullscreen {
        height: calc(100vh - var(--header-height) - var(--tab-height-sp) - var(--footer-height));
        min-width: 0;
        transform: translateY(0);
        bottom: calc(var(--tab-height-sp) + var(--footer-height));
        top: var(--header-height);
        z-index: var(--z-list-fullscreen);
    }
    
    .list-panel-wrapper.fullscreen .content-list {
        width: 100%;
    }
    
    /* ========================================
       検索入力エリアのプルダウン対応
       ======================================== */
    .tag-area {
        padding: 10px var(--spacing-md);
    }
    
    .search-input-container {
        display: flex;
        align-items: flex-start;
        gap: 5px;
        max-height: 30px;
        overflow: hidden;
        margin-bottom: var(--spacing-sm);
    }
    
    .search-input-container.expanded {
        max-height: 300px;
    }
    
    .search-input-area {
        flex: 1;
        min-width: 0;
        max-height: none;
        overflow-y: auto;
        margin-bottom: 0;
    }
    
    .search-input-area:empty {
        max-height: 0;
    }
    
    .search-input-container.expanded .search-input-area {
        margin-bottom: 0;
    }
    
    .search-input-toggle {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        width: auto;
        padding: var(--spacing-xs) 6px;
        background: var(--color-gray-200);
        border: none;
        border-radius: var(--radius-full);
        cursor: pointer;
        font-size: var(--font-md);
        color: var(--color-text-secondary);
        line-height: 1;
        margin-top: 0;
        transition: background var(--transition-fast);
    }
    
    .search-input-toggle:hover {
        background: var(--color-primary);
        color: var(--color-text-white);
    }
    
    .search-input-toggle.hide {
        display: none;
    }
    
    /* ========================================
       サジェスト表示修正（SP縦画面専用）
       ======================================== */
    .search-suggestions {
        /* 修正: overflow:hiddenの影響を受けないようfixed配置に変更 */
        position: fixed;
        /* タグエリアの位置に合わせて動的に配置（JSで制御推奨） */
        top: auto;
        bottom: auto;
        left: var(--spacing-md);
        right: var(--spacing-md);
        max-height: 150px;
        /* z-indexを更に高く */
        z-index: 1001;
    }
    
    /* ========================================
       SP縦時のコントロール調整
       ======================================== */
    .control-area {
        padding: var(--spacing-xs) 6px;
        position: relative;
    }
    
    .list-panel-wrapper.fullscreen .control-area {
        position: fixed;
        bottom: calc(var(--tab-height-sp) + var(--footer-height));
        left: 0;
        right: 0;
        z-index: 100;
        background: rgba(248, 248, 248, 0.95);
        backdrop-filter: blur(5px);
        border-top: 1px solid var(--color-border-light);
    }

    .control-row {
        gap: 2px;
    }

    .slider-label {
        font-size: 7px;
        min-width: 6px;
    }

    .wide-toggle {
        min-width: 12px;
        height: 14px;
        font-size: 8px;
        padding: 1px 2px;
    }

    .grid-size-slider {
        height: 2px;
    }

    .grid-size-slider::-webkit-slider-thumb {
        width: 6px;
        height: 6px;
    }

    .grid-size-slider::-moz-range-thumb {
        width: 6px;
        height: 6px;
    }

    .thumbnail-area {
        padding-left: var(--spacing-md);
    }

    .thumbnail-container {
        margin-left: 3px;
        padding-right: var(--spacing-md);
    }
    
    .list-panel-wrapper.fullscreen .thumbnail-area {
        padding-bottom: 50px;
    }
}
